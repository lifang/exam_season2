<%= javascript_include_tag "report_error" %>
<%= javascript_include_tag "jplayer/jquery.jplayer.min" %>
<script type="text/javascript">
  var answer=""
  function get_answer(str){
    answer +=str.split(")")[0]+".";
  }
</script>

<% if @errors.blank? %>
  <div class="error_top">
    <%= render :partial=>"/report_errors/types" %>
    <%= "没有错误报告"   %>
  </div>
<% else %>
  <%error=@single_error[0] %>
  <div class="error_top">
    <%= render :partial=>"/report_errors/types" %>
    <div class="error_baog"><p>报告人：<span><%= error.u_name %></span></p><p><a href="javascript:$('.error_tab_list').css('display','block');">共有<%= @others %>人报告</a></p></div>
    <div class="error_explain">错误说明：
      <span><%= error.r_desc %></span>
    </div>
    <%= form_for :error_list,:url=>"/report_errors/modify_status",:html=>{:id=>"error_form"} do %>
      <input type="hidden" value="<%=session[:error_type]%>" id="error_type" name="error_type"/>
      <input type="hidden" value="<%= params[:category] %>" id="category" name="category"/>
      <input type="hidden" value="" id="status" name="status"/>
      <input type="hidden" value="<%= error.error_id %>" name="id" id="id"/>
    <% end %>
    <div><button class="t_btn" onclick="javascript:modify_status(1)">改好了</button><button class="t_btn" onclick="javascript:modify_status(2)">忽略</button></div>
    <div>
      <span class="updown" onclick="javascript:window.location='/report_errors?category=<%= params[:category] %>&page=<%= @last %><%=
      unless session[:error_type].nil?
        "&error_type=#{session[:error_type]}"
            end %>'"><img src="/assets/icon_up.png"/></span>
      <span class="updown" onclick="javascript:window.location='/report_errors?category=<%= params[:category] %>&page=<%=@next  %><%=
      unless session[:error_type].nil?
        "&error_type=#{session[:error_type]}"
            end %>'"><img src="/assets/icon_down.png" /></span>
    </div>
  </div>
  <div class="error_box">
    <div class="error_text_h">
      <p><%=error.pe_title %></p>
      <h2>第<%=params[:page].nil? ? 1:params[:page].to_i+1 %>题（共<%=@num %>题）</h2>
    </div>
    <div class="error_nr">
      <%= error.p_title.to_s.html_safe  %>
    </div>
  </div>
  <div class="error_box">
    <div class="error_problem">
      <% unless  error.description.nil? or error.description == "" %>
        <div> <%= error.description.to_s.html_safe  %></div>
      <% end %>
      <script type="text/javascript">
        setCookie("init_block",<%= @block_postion %>);
        setCookie("init_problem",<%= @problem_postion %>);
      </script>
      <%= render :partial=>"/report_errors/error",:object=>error %>
    </div>
  </div>
  <div class="error_jiexi_tab" id="jiexi">
    <span class="yj_x"><img src="/assets/x.gif" onclick="javascript:$('#jiexi').css('display','none');" /></span>
    <div class="xs_add"><%=  (error.analysis.nil?||error.analysis=="")? "此题没有解析":error.analysis %></div>
  </div>
  <%= render :partial=>"/report_errors/detail",:object=>@question %>
  <div class="error_tab_list"></div>
  <script type="text/javascript">
    $(".answer_true").html(answer);
    get_others(<%= error.question_id %>);
  </script>
<% end %>